---

- name: install Lmod
  package:
    name: Lmod
    state: present

- name: install lmod config
  copy:
    dest: /etc/profile.d/10-modules.sh
    content: MODULEPATH={{ software_install_dir }}/manual_modules/

- name: Append common modulepath
  lineinfile:
    dest: /etc/profile.d/zz0_lmod.sh
    line: export MODULEPATH=$(/usr/share/lmod/lmod/libexec/addto --append MODULEPATH /mnt/shared/home/easybuild/common/modules/all)
  become: yes

- name: Add x86_64 to modulepath
  lineinfile:
    dest: /etc/profile.d/zz0_lmod.sh
    line: export MODULEPATH=$(/usr/share/lmod/lmod/libexec/addto --append MODULEPATH /mnt/shared/home/easybuild/x86_64/modules/all)
  become: yes